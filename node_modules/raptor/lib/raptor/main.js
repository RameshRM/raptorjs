var loaded = false;
var _coreModulesDir = null;

var nodePath = require('path');

var requireModuleFile = function(path) {
    require(nodePath.join(_coreModulesDir, path));
};

var setCoreModulesDir = function(coreModulesDir) {
    _coreModulesDir = coreModulesDir;
};

exports.setCoreModulesDir = setCoreModulesDir;

exports.createRaptor = function(config) {
    
    if (!loaded) {
        if (_coreModulesDir) {
            try
            {
                require(nodePath.join(_coreModulesDir, "bootstrap/bootstrap_server.js"));
                raptorBootstrap.env = "node";
                raptorBootstrap.require = function(path) {
                    require(nodePath.join(_coreModulesDir, path));
                };
                
                raptorBootstrap.load();
                loaded = true;
            }
            catch(e)
            {
                throw new Error('Unable to initialize RaptorJS using the core modules directory  provided ("' + _coreModulesDir + '"). Exception: ' + e);
            }
        }
        else {
            throw new Error('Unable to initialize RaptorJS. Use the following statement to set the location of the core modules: require("raptor").setCoreModulesDir("<core_modules_dir>")');
        }
        
    }
    raptor = raptorBuilder.createRaptor(config); 
    return raptor;
};